(function(e,t){if(typeof define==="function"&&define.amd){define([],t)}else if(typeof module==="object"&&module.exports){module.exports=t()}else{e.Idiomorph=e.Idiomorph||t()}})(typeof self!=="undefined"?self:this,function(){return function(){"use strict";let o=new Set;function e(e,t,n={}){if(e instanceof Document){e=e.documentElement}if(typeof t==="string"){t=y(t)}let l=A(t);let r=h(e,l,n);return u(e,l,r)}function u(r,i,o){if(o.head.block){let t=r.querySelector("head");let n=i.querySelector("head");if(t&&n){let e=s(n,t,o);Promise.all(e).then(function(){u(r,i,Object.assign(o,{head:{block:false,ignore:true}}))});return}}if(o.morphStyle==="innerHTML"){l(i,r,o);return r.children}else if(o.morphStyle==="outerHTML"||o.morphStyle==null){let e=N(i,r,o);let t=e?.previousSibling;let n=e?.nextSibling;let l=f(r,e,o);if(e){return M(t,l,n)}else{return[]}}else{throw"Do not understand how to morph style "+o.morphStyle}}function d(e,t){return t.ignoreActiveValue&&e===document.activeElement}function f(e,t,n){if(n.ignoreActive&&e===document.activeElement){}else if(t==null){if(n.callbacks.beforeNodeRemoved(e)===false)return;e.remove();n.callbacks.afterNodeRemoved(e);return null}else if(!b(e,t)){if(n.callbacks.beforeNodeRemoved(e)===false)return;if(n.callbacks.beforeNodeAdded(t)===false)return;e.parentElement.replaceChild(t,e);n.callbacks.afterNodeAdded(t);n.callbacks.afterNodeRemoved(e);return t}else{if(n.callbacks.beforeNodeMorphed(e,t)===false)return;if(e instanceof HTMLHeadElement&&n.head.ignore){}else if(e instanceof HTMLHeadElement&&n.head.style!=="morph"){s(t,e,n)}else{r(t,e,n);if(!d(e,n)){l(t,e,n)}}n.callbacks.afterNodeMorphed(e,t);return e}}function l(n,l,r){let i=n.firstChild;let o=l.firstChild;let u;while(i){u=i;i=u.nextSibling;if(o==null){if(r.callbacks.beforeNodeAdded(u)===false)return;l.appendChild(u);r.callbacks.afterNodeAdded(u);E(r,u);continue}if(m(u,o,r)){f(o,u,r);o=o.nextSibling;E(r,u);continue}let e=v(n,l,u,o,r);if(e){o=g(o,e,r);f(e,u,r);E(r,u);continue}let t=S(n,l,u,o,r);if(t){o=g(o,t,r);f(t,u,r);E(r,u);continue}if(r.callbacks.beforeNodeAdded(u)===false)return;l.insertBefore(u,o);r.callbacks.afterNodeAdded(u);E(r,u)}while(o!==null){let e=o;o=o.nextSibling;w(e,r)}}function r(t,n,e){let l=t.nodeType;if(l===1){const r=t.attributes;const i=n.attributes;for(const o of r){if(o.name==="value"&&d(n,e)){continue}if(n.getAttribute(o.name)!==o.value){n.setAttribute(o.name,o.value)}}for(let e=i.length-1;0<=e;e--){const u=i[e];if(!t.hasAttribute(u.name)){n.removeAttribute(u.name)}}}if(l===8||l===3){if(n.nodeValue!==t.nodeValue){n.nodeValue=t.nodeValue}}if(!d(n,e)){a(t,n)}}function i(e,t,n){if(e[n]!==t[n]){t[n]=e[n];if(e[n]){t.setAttribute(n,e[n])}else{t.removeAttribute(n)}}}function a(n,l){if(n instanceof HTMLInputElement&&l instanceof HTMLInputElement&&n.type!=="file"){let e=n.value;let t=l.value;i(n,l,"checked");i(n,l,"disabled");if(!n.hasAttribute("value")){l.value="";l.removeAttribute("value")}else if(e!==t){l.setAttribute("value",e);l.value=e}}else if(n instanceof HTMLOptionElement){i(n,l,"selected")}else if(n instanceof HTMLTextAreaElement&&l instanceof HTMLTextAreaElement){let e=n.value;let t=l.value;if(e!==t){l.value=e}if(l.firstChild&&l.firstChild.nodeValue!==e){l.firstChild.nodeValue=e}}}function s(e,t,l){let r=[];let i=[];let o=[];let u=[];let d=l.head.style;let f=new Map;for(const n of e.children){f.set(n.outerHTML,n)}for(const s of t.children){let e=f.has(s.outerHTML);let t=l.head.shouldReAppend(s);let n=l.head.shouldPreserve(s);if(e||n){if(t){i.push(s)}else{f.delete(s.outerHTML);o.push(s)}}else{if(d==="append"){if(t){i.push(s);u.push(s)}}else{if(l.head.shouldRemove(s)!==false){i.push(s)}}}}u.push(...f.values());p("to append: ",u);let a=[];for(const c of u){p("adding: ",c);let n=document.createRange().createContextualFragment(c.outerHTML).firstChild;p(n);if(l.callbacks.beforeNodeAdded(n)!==false){if(n.href||n.src){let t=null;let e=new Promise(function(e){t=e});n.addEventListener("load",function(){t()});a.push(e)}t.appendChild(n);l.callbacks.afterNodeAdded(n);r.push(n)}}for(const h of i){if(l.callbacks.beforeNodeRemoved(h)!==false){t.removeChild(h);l.callbacks.afterNodeRemoved(h)}}l.head.afterHeadMorphed(t,{added:r,kept:o,removed:i});return a}function p(){}function c(){}function h(e,t,n){return{target:e,newContent:t,config:n,morphStyle:n.morphStyle,ignoreActive:n.ignoreActive,ignoreActiveValue:n.ignoreActiveValue,idMap:R(e,t),deadIds:new Set,callbacks:Object.assign({beforeNodeAdded:c,afterNodeAdded:c,beforeNodeMorphed:c,afterNodeMorphed:c,beforeNodeRemoved:c,afterNodeRemoved:c},n.callbacks),head:Object.assign({style:"merge",shouldPreserve:function(e){return e.getAttribute("im-preserve")==="true"},shouldReAppend:function(e){return e.getAttribute("im-re-append")==="true"},shouldRemove:c,afterHeadMorphed:c},n.head)}}function m(e,t,n){if(e==null||t==null){return false}if(e.nodeType===t.nodeType&&e.tagName===t.tagName){if(e.id!==""&&e.id===t.id){return true}else{return H(n,e,t)>0}}return false}function b(e,t){if(e==null||t==null){return false}return e.nodeType===t.nodeType&&e.tagName===t.tagName}function g(t,e,n){while(t!==e){let e=t;t=t.nextSibling;w(e,n)}E(n,e);return e.nextSibling}function v(n,e,l,r,i){let o=H(i,l,e);let t=null;if(o>0){let e=r;let t=0;while(e!=null){if(m(l,e,i)){return e}t+=H(i,e,n);if(t>o){return null}e=e.nextSibling}}return t}function S(e,t,n,l,r){let i=l;let o=n.nextSibling;let u=0;while(i!=null){if(H(r,i,e)>0){return null}if(b(n,i)){return i}if(b(o,i)){u++;o=o.nextSibling;if(u>=2){return null}}i=i.nextSibling}return i}function y(n){let l=new DOMParser;let e=n.replace(/<svg(\s[^>]*>|>)([\s\S]*?)<\/svg>/gim,"");if(e.match(/<\/html>/)||e.match(/<\/head>/)||e.match(/<\/body>/)){let t=l.parseFromString(n,"text/html");if(e.match(/<\/html>/)){t.generatedByIdiomorph=true;return t}else{let e=t.firstChild;if(e){e.generatedByIdiomorph=true;return e}else{return null}}}else{let e=l.parseFromString("<body><template>"+n+"</template></body>","text/html");let t=e.body.querySelector("template").content;t.generatedByIdiomorph=true;return t}}function A(e){if(e==null){const t=document.createElement("div");return t}else if(e.generatedByIdiomorph){return e}else if(e instanceof Node){const t=document.createElement("div");t.append(e);return t}else{const t=document.createElement("div");for(const n of[...e]){t.append(n)}return t}}function M(e,t,n){let l=[];let r=[];while(e!=null){l.push(e);e=e.previousSibling}while(l.length>0){let e=l.pop();r.push(e);t.parentElement.insertBefore(e,t)}r.push(t);while(n!=null){l.push(n);r.push(n);n=n.nextSibling}while(l.length>0){t.parentElement.insertBefore(l.pop(),t.nextSibling)}return r}function N(e,t,n){let l;l=e.firstChild;let r=l;let i=0;while(l){let e=k(l,t,n);if(e>i){r=l;i=e}l=l.nextSibling}return r}function k(e,t,n){if(b(e,t)){return.5+H(n,e,t)}return 0}function w(e,t){E(t,e);if(t.callbacks.beforeNodeRemoved(e)===false)return;e.remove();t.callbacks.afterNodeRemoved(e)}function T(e,t){return!e.deadIds.has(t)}function x(e,t,n){let l=e.idMap.get(n)||o;return l.has(t)}function E(e,t){let n=e.idMap.get(t)||o;for(const l of n){e.deadIds.add(l)}}function H(e,t,n){let l=e.idMap.get(t)||o;let r=0;for(const i of l){if(T(e,i)&&x(e,i,n)){++r}}return r}function L(e,n){let l=e.parentElement;let t=e.querySelectorAll("[id]");for(const r of t){let t=r;while(t!==l&&t!=null){let e=n.get(t);if(e==null){e=new Set;n.set(t,e)}e.add(r.id);t=t.parentElement}}}function R(e,t){let n=new Map;L(e,n);L(t,n);return n}return{morph:e}}()});htmx.defineExtension("morph",{isInlineSwap:function(e){return e==="morph"},handleSwap:function(e,t,n){if(e==="morph"||e==="morph:outerHTML"){return Idiomorph.morph(t,n.children)}else if(e==="morph:innerHTML"){return Idiomorph.morph(t,n.children,{morphStyle:"innerHTML"})}}});